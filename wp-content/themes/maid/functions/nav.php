<?php
/*
====================
    MAIN NAVIGATION
====================
*/

if ( ! class_exists( 'Custom_Nav_Menu' ) ) {
	class Custom_Nav_Menu extends Walker_Nav_Menu {
		/**
		 * Specify the item type to allow different walkers
		 * @var array
		 */
		var $nav_bar = '';

		// Used for counting menus
		static $count = 0;

		function __construct( $nav_args = '' ) {
			$defaults      = array(
				'item_type'  => 'li',
				'in_top_bar' => false
			);
			$this->nav_bar = apply_filters( 'req_nav_args', wp_parse_args( $nav_args, $defaults ) );
		}

		function display_element( $element, &$children_elements, $max_depth, $depth = 0, $args, &$output ) {
			$id_field = $this->db_fields['id'];
			if ( is_object( $args[0] ) ) {
				$args[0]->has_children = ! empty( $children_elements[ $element->$id_field ] );
			}

			return parent::display_element( $element, $children_elements, $max_depth, $depth, $args, $output );
		}

		function start_el( &$output, $item, $depth = 0, $args = array(), $id = 0 ) {
			global $wp_query;
			$indent      = ( $depth ) ? str_repeat( "\t", $depth ) : '';
			$class_names = $value = '';
			$classes     = empty( $item->classes ) ? array() : (array) $item->classes;
			$classes[]   = 'menu-item-' . $item->ID;

			// Reset count if top level parent of depth 0
			if ( $depth == 0 ) {
				self::$count ++;
			}

			// Check for flyout
			$flyout_toggle = '';
			if ( $args->has_children && $this->nav_bar['item_type'] == 'li' ) {
				if ( $depth == 0 && $this->nav_bar['in_top_bar'] == false ) {
					$classes[] = 'has-drop';
				} else if ( $this->nav_bar['in_top_bar'] == true ) {
					$classes[]     = 'has-dropdown';
					$flyout_toggle = '';
				}
			}
			/**
			 * Add class names to the li.divider from parent menu item
			 * @var string
			 *
			 * @since  required+ Foundation 1.0.7
			 */
			$class_names_divider = join( ' ', $item->classes );
			$class_names         = join( ' ', apply_filters( 'nav_menu_css_class', array_filter( $classes ), $item, $args ) );
			$class_names         = $class_names ? ' class="' . esc_attr( $class_names ) . '"' : '';

			// Add center logo
			if ( $depth === 0 && self::$count == 3 ) {
				$output .= $indent . '
        <li class="menu-item logo">
            <a href="' . home_url() . '">
                <svg class="icon icon-logo-full" version="1.1" viewBox="0 0 150 105.5"">
                    <g>
                        <g>
                            <path fill="#535253" d="M0,43.1c2.4-1.2,4.8-2.4,7.2-3.4c3.2-1.4,4.9,0.9,4.9,6.8c0.1,5.1,0.1,10.2,0.2,15.2
                                c0.1,5.8-1.6,9-4.8,9.5c-1.1,0.2-2.3,0.4-3.4,0.5c0,5.8,0.1,11.5,0.1,17.3c-1.4,0-2.8,0-4.2,0C0,73.7,0,58.4,0,43.1z M4.1,65.9
                                c0.9-0.2,1.7-0.4,2.6-0.6c1.1-0.2,1.6-1.3,1.6-3.2c0-4.6-0.1-9.2-0.1-13.8c0-1.9-0.6-2.7-1.8-2.2c-0.8,0.3-1.6,0.6-2.3,0.9
                                C4,53.3,4,59.6,4.1,65.9z"/>
                            <path fill="#535253" d="M14.8,89c-0.2-17.4-0.4-34.8-0.6-52.2c3.4-1.3,6.8-2.4,10.2-3.4c0,2.2,0.1,4.5,0.1,6.7
                                c-2,0.5-4.1,1.1-6.1,1.7c0.1,5.4,0.1,10.9,0.2,16.3c1.8-0.4,3.6-0.7,5.4-1c0,2.2,0.1,4.5,0.1,6.7c-1.8,0.2-3.6,0.5-5.4,0.8
                                c0.1,6,0.1,11.9,0.2,17.9c2-0.1,4.1-0.2,6.1-0.2c0,2.2,0.1,4.5,0.1,6.7C21.7,89,18.2,89,14.8,89z"/>
                            <path fill="#535253" d="M26.3,32.8c2.7-0.8,5.4-1.4,8.2-2c3.2-0.7,4.9,2.4,4.9,9.2c0,4.9,0.1,9.7,0.1,14.6c0.1,5.2-0.7,8.5-2.4,10
                                c1.1,8.1,2.1,16.2,3.2,24.4c-1.3,0-2.6,0-3.9,0c-1-7.9-2-15.7-3-23.4c-0.8,0.1-1.7,0.2-2.5,0.2c0.1,7.7,0.2,15.4,0.3,23.1
                                c-1.4,0-2.8,0-4.2,0C26.8,70.3,26.5,51.6,26.3,32.8z M30.8,59.3c0.9-0.1,1.8-0.2,2.7-0.3c1.2-0.1,1.9-1.6,1.8-4.4
                                c0-4.2-0.1-8.4-0.1-12.6c0-2.8-0.7-4.1-1.9-3.9c-0.9,0.2-1.8,0.4-2.7,0.6C30.6,45.6,30.7,52.4,30.8,59.3z"/>
                            <path fill="#535253" d="M51.7,54c0,2.5,0,4.9,0,7.4c-1.8,0.1-3.7,0.2-5.5,0.3c0.1,9.1,0.1,18.2,0.2,27.3c-1.4,0-2.8,0-4.2,0
                                c-0.2-19.9-0.4-39.7-0.6-59.6c3.5-0.6,7-1,10.5-1.3c0,2.5,0,4.9,0,7.4c-2.1,0.2-4.2,0.4-6.3,0.6c0,6.1,0.1,12.2,0.1,18.3
                                C48,54.2,49.9,54.1,51.7,54z"/>
                            <path fill="#535253" d="M54.3,89c-0.1-20.3-0.2-40.7-0.3-61c3.5-0.3,7.1-0.4,10.6-0.4c0,2.5,0,5,0,7.4c-2.1,0-4.2,0-6.3,0.1
                                c0,6.2,0,12.4,0.1,18.6c1.8,0,3.7-0.1,5.5-0.1c0,2.5,0,5,0,7.4c-1.8,0-3.7,0-5.5,0.1c0,6.8,0,13.6,0.1,20.4c2.1,0,4.1,0,6.2,0
                                c0,2.5,0,5,0,7.4C61.2,89,57.8,89,54.3,89z"/>
                            <path fill="#535253" d="M79,74.8c0,1.3,0,2.6,0,3.9c0,6.9-1.7,10.3-5,10.3c-0.9,0-1.8,0-2.7,0c-3.3,0-5-3.5-5-10.4
                                c0-13.5,0-27,0-40.5c0-6.9,1.7-10.4,5.1-10.3c0.9,0,1.8,0.1,2.8,0.2c3.4,0.2,5.1,3.9,5,10.7c0,2.3,0,4.6,0,6.8
                                c-1.4-0.1-2.8-0.2-4.2-0.3c0-2.1,0-4.2,0-6.3c0-2.4-0.6-3.6-1.9-3.7c-0.3,0-0.6,0-0.8,0c-1.1-0.1-1.7,1.1-1.7,3.5
                                c0,13.1-0.1,26.2-0.1,39.3c0,2.4,0.5,3.6,1.6,3.6c0.3,0,0.7,0,1,0c1.1,0,1.7-1.2,1.7-3.6c0-1.1,0-2.2,0-3.3
                                C76.3,74.7,77.7,74.8,79,74.8z"/>
                            <path fill="#535253" d="M88.3,36.8c-0.2,17.4-0.3,34.8-0.5,52.2c-1.4,0-2.8,0-4.2,0c0.1-17.6,0.3-35.2,0.4-52.8
                                c-1.4-0.2-2.7-0.3-4.1-0.4c0-2.4,0-4.9,0-7.3c4.1,0.5,8.3,1.1,12.4,1.9c0,2.4-0.1,4.7-0.1,7.1C91,37.2,89.6,37,88.3,36.8z"/>
                            <path fill="#535253" d="M93,89c0.2-19.5,0.4-38.9,0.7-58.4c1.4,0.3,2.8,0.6,4.2,0.9c-0.2,19.1-0.5,38.3-0.7,57.4
                                C95.8,89,94.4,89,93,89z"/>
                            <path fill="#535253" d="M104.8,89c-3.3,0-5-3.2-4.9-9.6c0.2-12.5,0.3-24.9,0.5-37.4c0.1-6.5,1.8-9.3,5.1-8.3
                                c1.3,0.4,2.6,0.8,4,1.2c3.3,1.1,4.9,4.8,4.8,10.7c-0.1,11.5-0.3,23-0.4,34.5c-0.1,5.9-1.8,8.9-5.1,8.9C107.4,89,106.1,89,104.8,89
                                z M105.9,82.3c0.7,0,1.4,0.1,2.1,0.1c1.1,0,1.7-1,1.7-3.1c0.1-11.5,0.3-23,0.4-34.5c0-2.1-0.6-3.3-1.8-3.7
                                c-0.6-0.2-1.3-0.4-1.9-0.5c-1.2-0.3-1.8,0.6-1.9,2.8c-0.2,11.9-0.3,23.8-0.5,35.6C104,81.2,104.6,82.3,105.9,82.3z"/>
                            <path fill="#535253" d="M125,64.3c0-7.7,0.1-15.4,0.1-23.1c1.3,0.6,2.6,1.3,3.9,1.9c0,15.3,0,30.6,0,45.9c-1.4,0-2.8,0-4.2,0
                                c0-3.2,0-6.4,0-9.5c-1.4-7.4-2.8-15.1-4.2-23.1c-0.1,10.9-0.2,21.7-0.3,32.6c-1.4,0-2.8,0-4.2,0c0.2-17.1,0.4-34.3,0.5-51.4
                                c1.3,0.5,2.7,1.1,4,1.7C122.2,47.9,123.6,56.2,125,64.3z"/>
                        </g>
                        <g>
                            <path fill="#535253" d="M4.6,103v0.7c0,1.2-0.6,1.8-1.7,1.8H1.9c-1.1,0-1.7-0.6-1.7-1.8v-7.1c0-1.2,0.6-1.8,1.7-1.8h0.9
                                c1.1,0,1.7,0.6,1.7,1.8v1.2H3.1v-1.1c0-0.4-0.2-0.6-0.6-0.6H2.2c-0.4,0-0.6,0.2-0.6,0.6v6.9c0,0.4,0.2,0.6,0.6,0.6h0.4
                                c0.4,0,0.6-0.2,0.6-0.6V103H4.6z"/>
                            <path fill="#535253" d="M12.1,105.5H8.7V94.7h1.4v9.4h2V105.5z"/>
                            <path fill="#535253" d="M15.9,105.5V94.7h3.6V96h-2.1v3.3h1.9v1.3h-1.9v3.6h2.1v1.3H15.9z"/>
                            <path fill="#535253" d="M24.8,105.5h-1.4v-8.9c0-1.2,0.6-1.8,1.7-1.8h1.1c1.1,0,1.7,0.6,1.7,1.8v8.9h-1.4v-3.9h-1.6V105.5z
                                 M26.5,100.2v-3.6c0-0.4-0.2-0.6-0.6-0.6h-0.4c-0.4,0-0.6,0.2-0.6,0.6v3.6H26.5z"/>
                            <path fill="#535253" d="M35.1,99.9v-5.2h1.4v10.7h-1.4v-2.1l-1.5-4.9v7h-1.4V94.7h1.4L35.1,99.9z"/>
                            <path fill="#535253" d="M40.9,105.5V94.7h1.4v10.7H40.9z"/>
                            <path fill="#535253" d="M49.6,99.9v-5.2h1.4v10.7h-1.4v-2.1l-1.5-4.9v7h-1.4V94.7h1.4L49.6,99.9z"/>
                            <path fill="#535253" d="M57.6,101.5v-1.3h2.2v5.2H57c-1.1,0-1.7-0.6-1.7-1.8v-7.1c0-1.2,0.6-1.8,1.7-1.8h1c1.2,0,1.8,0.6,1.8,1.9
                                v1.2h-1.4v-1c0-0.5-0.2-0.8-0.6-0.8h-0.4c-0.4,0-0.6,0.3-0.6,0.8v6.6c0,0.5,0.2,0.8,0.6,0.8h1v-2.6H57.6z"/>
                            <path fill="#535253" d="M72.1,97.6v-0.9c0-0.4-0.2-0.6-0.6-0.6h-0.2c-0.4,0-0.6,0.2-0.6,0.6v1.8c0,0.2,0,0.3,0.1,0.4
                                c0.1,0.1,0.2,0.2,0.4,0.3l1.4,0.7c0.3,0.2,0.5,0.3,0.6,0.4c0.1,0.1,0.2,0.2,0.3,0.3c0.1,0.1,0.1,0.4,0.1,0.8v2.3
                                c0,1.2-0.6,1.8-1.7,1.8h-0.9c-1.1,0-1.7-0.7-1.7-2V103h1.4v0.6c0,0.4,0.2,0.6,0.6,0.6h0.3c0.4,0,0.6-0.2,0.6-0.6v-1.8
                                c0-0.2,0-0.3-0.1-0.4c-0.1-0.1-0.2-0.2-0.4-0.3l-1.4-0.8c-0.3-0.2-0.5-0.3-0.7-0.4c-0.1-0.1-0.2-0.3-0.3-0.4
                                c-0.1-0.2-0.1-0.4-0.1-0.7v-2.2c0-1.2,0.6-1.8,1.7-1.8h0.9c1.1,0,1.7,0.6,1.7,1.8v1H72.1z"/>
                            <path fill="#535253" d="M77.7,105.5V94.7h3.6V96h-2.1v3.3H81v1.3h-1.9v3.6h2.1v1.3H77.7z"/>
                            <path fill="#535253" d="M85.3,94.7h2.8c1.1,0,1.6,0.6,1.6,1.8v2.6c0,0.9-0.3,1.5-0.9,1.8l1,4.5h-1.4l-0.9-4.3h-0.9v4.3h-1.4V94.7z
                                 M86.7,99.9h0.9c0.4,0,0.6-0.3,0.6-0.8v-2.3c0-0.5-0.2-0.8-0.6-0.8h-0.9V99.9z"/>
                            <path fill="#535253" d="M98.6,94.7l-1.7,10.7h-1.7l-1.7-10.7h1.4l1.2,8.2l1.2-8.2H98.6z"/>
                            <path fill="#535253" d="M102.4,105.5V94.7h1.4v10.7H102.4z"/>
                            <path fill="#535253" d="M112.4,103v0.7c0,1.2-0.6,1.8-1.7,1.8h-0.9c-1.1,0-1.7-0.6-1.7-1.8v-7.1c0-1.2,0.6-1.8,1.7-1.8h0.9
                                c1.1,0,1.7,0.6,1.7,1.8v1.2H111v-1.1c0-0.4-0.2-0.6-0.6-0.6h-0.3c-0.4,0-0.6,0.2-0.6,0.6v6.9c0,0.4,0.2,0.6,0.6,0.6h0.4
                                c0.4,0,0.6-0.2,0.6-0.6V103H112.4z"/>
                            <path fill="#535253" d="M116.5,105.5V94.7h3.6V96H118v3.3h1.9v1.3H118v3.6h2.1v1.3H116.5z"/>
                            <path fill="#535253" d="M126.9,97.6v-0.9c0-0.4-0.2-0.6-0.6-0.6H126c-0.4,0-0.6,0.2-0.6,0.6v1.8c0,0.2,0,0.3,0.1,0.4
                                c0.1,0.1,0.2,0.2,0.4,0.3l1.4,0.7c0.3,0.2,0.5,0.3,0.6,0.4c0.1,0.1,0.2,0.2,0.3,0.3c0.1,0.1,0.1,0.4,0.1,0.8v2.3
                                c0,1.2-0.6,1.8-1.7,1.8h-0.9c-1.1,0-1.7-0.7-1.7-2V103h1.4v0.6c0,0.4,0.2,0.6,0.6,0.6h0.3c0.4,0,0.6-0.2,0.6-0.6v-1.8
                                c0-0.2,0-0.3-0.1-0.4c-0.1-0.1-0.2-0.2-0.4-0.3l-1.4-0.8c-0.3-0.2-0.5-0.3-0.7-0.4c-0.1-0.1-0.2-0.3-0.3-0.4
                                c-0.1-0.2-0.1-0.4-0.1-0.7v-2.2c0-1.2,0.6-1.8,1.7-1.8h0.9c1.1,0,1.7,0.6,1.7,1.8v1H126.9z"/>
                        </g>
                        <g>
                            <path fill="#F68820" d="M27.6,17.3c1.4-4.6,2.7-9.1,4.1-13.6c1.6-0.4,3.3-0.7,4.9-1c0,7.1,0,14.3,0,21.4c-1.5,0.3-3,0.6-4.4,0.9
                                c0.2-4.7,0.3-9.4,0.5-14.1c-1.1,3.6-2.2,7.3-3.3,10.9c-1.1,0.3-2.3,0.6-3.4,0.9c-1.1-3.1-2.2-6.2-3.3-9.2
                                c0.2,4.6,0.3,9.3,0.5,13.9c-1.5,0.4-2.9,0.9-4.4,1.3c0-7.1,0-14.3,0-21.4c1.6-0.5,3.2-1,4.8-1.5C24.9,9.6,26.2,13.5,27.6,17.3z"/>
                            <path fill="#F68820" d="M43.9,22.9c-1.5,0.2-3,0.4-4.5,0.7c0-5.9,0-11.8,0-17.8c0-2.4,1.8-4,5.4-4.5c1.1-0.2,2.2-0.3,3.4-0.4
                                c3.6-0.4,5.4,0.7,5.4,3.2c0,5.9,0,11.8,0,17.8c-1.5,0.1-3,0.3-4.5,0.4c0-2.6,0-5.2,0-7.9c-1.7,0.2-3.4,0.4-5.1,0.6
                                C43.9,17.7,43.9,20.3,43.9,22.9z M49,11.8c0-2.4,0-4.8,0-7.1c0-0.8-0.7-1.2-2-1c-0.4,0-0.8,0.1-1.2,0.2c-1.3,0.2-2,0.7-2,1.5
                                c0,2.4,0,4.8,0,7.1C45.6,12.2,47.3,12,49,11.8z"/>
                            <path fill="#F68820" d="M56.3,21.7c0-7.1,0-14.3,0-21.4c1.5-0.1,3-0.1,4.5-0.2c0,7.1,0,14.3,0,21.4C59.4,21.5,57.8,21.6,56.3,21.7
                                z"/>
                            <path fill="#F68820" d="M63.9,21.4c0-7.1,0-14.3,0-21.4c2.6,0,5.2,0,7.9,0.2C76,0.4,78.1,2,78.1,4.7c0,4.7,0,9.5,0,14.2
                                c0,2.1-1.8,2.9-5.4,2.7C69.8,21.5,66.8,21.4,63.9,21.4z M68.4,18.9c1.1,0,2.3,0.1,3.4,0.1c1.2,0.1,1.8-0.2,1.8-0.9
                                c0-4.6,0-9.2,0-13.7c0-1-0.7-1.6-2-1.7c-1,0-2.1-0.1-3.1-0.1C68.4,8.1,68.4,13.5,68.4,18.9z"/>
                            <path fill="#F68820" d="M90.9,4.9c0,6.3,0,12.6,0,18.8c-1.5-0.3-3-0.5-4.5-0.7c0-6.3,0-12.6,0-18.8c-1.4-0.2-2.9-0.4-4.3-0.6
                                c0-0.9,0-1.7,0-2.6c4.4,0.5,8.7,1.2,13,2.1c0,0.9,0,1.7,0,2.6C93.7,5.4,92.3,5.1,90.9,4.9z"/>
                            <path fill="#F68820" d="M101.6,26c-3.6-0.9-5.3-2.5-5.3-4.9c0-4.7,0-9.4,0-14.1c0-2.4,1.8-3.3,5.3-2.4c1.4,0.4,2.8,0.7,4.2,1.1
                                c3.5,1,5.2,2.8,5.2,5.3c0,4.7,0,9.4,0,14.1c0,2.4-1.7,3-5.3,2C104.4,26.7,103,26.4,101.6,26z M102.7,23.7c0.8,0.2,1.5,0.4,2.2,0.6
                                c1.2,0.3,1.7,0.1,1.7-0.8c0-4.6,0-9.2,0-13.7c0-0.8-0.7-1.4-2-1.8c-0.7-0.2-1.4-0.4-2.1-0.6c-1.3-0.3-1.9-0.1-1.9,0.8
                                c0,4.6,0,9.2,0,13.7C100.7,22.8,101.4,23.4,102.7,23.7z"/>
                        </g>
                        <g class="sparkle-one">
                            <path fill="#F68820" d="M129.1,16.5c-6.5,0-8.3,1.8-8.3,8.3c0-6.5-1.8-8.3-8.3-8.3c6.5,0,8.3-1.7,8.3-8.3
                            C120.9,14.7,122.6,16.5,129.1,16.5z"/>
                        </g>
                        <g class="sparkle-two">
                            <path fill="#F68820" d="M150,21.1c-7.7,0-12.4,4.7-12.4,12.4c0-7.7-4.7-12.4-12.4-12.4c7.7,0,12.4-4.7,12.4-12.4
                            C137.6,16.4,142.3,21.1,150,21.1z"/>
                        </g>
                        <g class="sparkle-three">
                            <path fill="#F68820" d="M135.4,35.1c-2,0-4.3,2.3-4.3,4.3c0-2-2.3-4.3-4.3-4.3c2,0,4.3-2.3,4.3-4.3
                            C131.2,32.8,133.5,35.1,135.4,35.1z"/>
                        </g>
                    </g>
                  </svg>
                </a>
              </li>';
			}

			if ( $depth > 0 ) {
				$output .= $indent . '<li id="menu-item-' . $item->ID . '"' . $value . $class_names . '>';
			} else {
				$output .= $indent . ( $this->nav_bar['in_top_bar'] == true ? '<li class="divider' . $class_names_divider . '"></li>' : '' ) . '<' . $this->nav_bar['item_type'] . ' id="menu-item-' . $item->ID . '"' . $value . $class_names . '>';
			}

			$attributes = ! empty( $item->attr_title ) ? ' title="' . esc_attr( $item->attr_title ) . '"' : '';
			$attributes .= ! empty( $item->target ) ? ' target="' . esc_attr( $item->target ) . '"' : '';
			$attributes .= ! empty( $item->xfn ) ? ' rel="' . esc_attr( $item->xfn ) . '"' : '';
			$attributes .= ! empty( $item->url ) ? ' href="' . esc_attr( $item->url ) . '"' : '';

			$item_output = $args->before;
			$item_output .= '<a ' . $attributes . '>';
			$item_output .= $args->link_before . apply_filters( 'the_title', $item->title, $item->ID ) . $args->link_after;
			$item_output .= '</a>';
			$item_output .= $flyout_toggle; // Add possible flyout toggle
			$item_output .= $args->after;

			$output .= apply_filters( 'walker_nav_menu_start_el', $item_output, $item, $depth, $args );
		}

		function end_el( &$output, $item, $depth = 0, $args = array() ) {
			if ( $depth > 0 ) {
				$output .= "</li>\n";
			} else {
				$output .= "</" . $this->nav_bar['item_type'] . ">\n";
			}
		}

		function start_lvl( &$output, $depth = 0, $args = array() ) {
			if ( $depth == 0 && $this->nav_bar['item_type'] == 'li' ) {
				$indent = str_repeat( "\t", 1 );
				$output .= $this->nav_bar['in_top_bar'] == true ? "\n$indent<ul class=\"dropdown\">\n" : "\n$indent<ul class=\"navdrop\">\n";
			} else {
				$indent = str_repeat( "\t", $depth );
				$output .= $this->nav_bar['in_top_bar'] == true ? "\n$indent<ul class=\"dropdown\">\n" : "\n$indent<ul class=\"level-$depth\">\n";
			}
		}
	}
}